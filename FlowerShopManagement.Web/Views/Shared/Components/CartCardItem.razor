<div class="form-check mb-3">
	<input class="form-check-input fs-4 me-2" type="checkbox" value="" id="defaultCheck1" checked=@isSelected @onchange="SelectItem">
	<div class="card d-flex flex-row">
		<img src="image/flower2.png" class="card-img-top w-25 h-auto" />
		<div class="card-body d-flex flex-column justify-content-between">
			<div class="">
				<div class="d-flex justify-content-between">
					<span class="h4">@cartItem.items.Name</span>
					<span class="h6 icon-arrow"></span>
				</div>
				<div class="mt-1 d-flex justify-content-between align-items-end">
					<span class="h6">$@cartItem.items.UniPrice</span>
					<span class="h3 fw-bold text-primary">$@(cartItem.items.UniPrice * cartItem.amount)</span>
				</div>
			</div>
			<div class="mt-1 d-flex justify-content-between align-items-end">
				<Counter count="@((int)cartItem.amount)" max=@cartItem.items.Amount OnGetAmount="ChangeAmount" />
				<p class="icon-delete fs-5 m-0 icon-normal text-color-pink hover-icon" @onclick="RemoveOutOfCart"></p>
			</div>
		</div>
	</div>
</div>

@code {

	[Parameter]
	public CartItemModel cartItem { get; set; }

	[Parameter]
	public string id { get; set; } = null!;

	[Parameter]
	public string url { get; set; } = null!;

	[Parameter]
	public string url1 { get; set; } = null!;

	[Parameter]
	public string url2 { get; set; } = null!;

	[Parameter]
	public string url3 { get; set; } = null!;

	[Parameter]
	public bool isSelected { get; set; } = false;

	[Parameter]
	public EventCallback<MyArgs> IsChanged { get; set; }

	protected async void ChangeAmount(int count)
	{
		cartItem.amount = count;
		StateHasChanged();

		await js.InvokeVoidAsync("updateAmount", new object[] { url1, url3, cartItem._productId, count });
	}

	private async void RemoveOutOfCart()
	{
		if (cartItem._productId != null)
		{
			await js.InvokeVoidAsync("callWithId", new object[] { url, cartItem._productId });
			StateHasChanged();
		}
	}

	private async void SelectItem()
	{
		isSelected = !isSelected;
		StateHasChanged();

		await js.InvokeVoidAsync("updateSelection", new object[] { url2, url3, id, isSelected });
	}
}
